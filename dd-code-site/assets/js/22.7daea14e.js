(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{517:function(e,s,v){"use strict";v.r(s);var _=v(6),t=Object(_.a)({},(function(){var e=this,s=e.$createElement,v=e._self._c||s;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("ol",[v("li",[v("p",[e._v("对查询进行优化，应尽量避免全表扫描，首先应考虑在 "),v("code",[e._v("where")]),e._v(" 及 "),v("code",[e._v("order by")]),e._v(" 涉及的列上建立索引。")])]),e._v(" "),v("li",[v("p",[e._v("应尽量避免在 "),v("code",[e._v("where")]),e._v(" 子句中对字段进行 "),v("code",[e._v("null")]),e._v(" 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如："),v("code",[e._v("select id from t where num is null")]),e._v(" 可以在 "),v("code",[e._v("num")]),e._v(" 上设置默认值 0，确保表中 "),v("code",[e._v("num")]),e._v(" 列没有 "),v("code",[e._v("null")]),e._v(" 值，然后这样查询：")]),e._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" id "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" t "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" num"),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),v("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br")])])]),e._v(" "),v("li",[v("p",[e._v("应尽量避免在 "),v("code",[e._v("where")]),e._v(" 子句中使用 "),v("code",[e._v("!=")]),e._v(" 或 "),v("code",[e._v("<>")]),e._v(" 操作符，否则引擎将放弃使用索引而进行全表扫描。")])]),e._v(" "),v("li",[v("p",[e._v("应尽量避免在 "),v("code",[e._v("where")]),e._v(" 子句中使用 "),v("code",[e._v("or")]),e._v(" 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如："),v("code",[e._v("select id from t where num=10 or num=20")]),e._v(" 可以这样查询：")]),e._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" id "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" t "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" num"),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),v("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("union")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("all")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" id "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" t "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" num"),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),v("span",{pre:!0,attrs:{class:"token number"}},[e._v("20")]),e._v("\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br")])])]),e._v(" "),v("li",[v("p",[v("code",[e._v("in")]),e._v(" 和 "),v("code",[e._v("not in")]),e._v(" 也要慎用，否则会导致全表扫描，如："),v("code",[e._v("select id from t where num in(1,2,3)")]),e._v(" 对于连续的数值，能用 "),v("code",[e._v("between")]),e._v(" 就不要用 "),v("code",[e._v("in")]),e._v(" 了：")]),e._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" id "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" t "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" num "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("between")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("and")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br")])])]),e._v(" "),v("li",[v("p",[e._v("下面的查询也将导致全表扫描："),v("code",[e._v("select id from t where name like ‘%李%’")]),e._v("， 若要提高效率，可以考虑全文检索：")]),e._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[e._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" id "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" t "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" name "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" ‘X李X’\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br")])])]),e._v(" "),v("li",[v("p",[e._v("如果在 "),v("code",[e._v("where")]),e._v(" 子句中使用参数，也会导致全表扫描。因为 SQL 只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项，如下面语句将进行全表扫描："),v("code",[e._v("select id from t where num=@num")]),e._v(" 可以改为强制查询使用索引："),v("code",[e._v("select id from t with(index(索引名)) where num=@num")])])]),e._v(" "),v("li",[v("p",[e._v("应尽量避免在 "),v("code",[e._v("where")]),e._v(" 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描，如：")]),e._v(" "),v("p",[v("code",[e._v("select id from t where num/2=100")]),e._v(" 应改为: "),v("code",[e._v("select id from t where num=100*2")])])]),e._v(" "),v("li",[v("p",[e._v("应尽量避免在 "),v("code",[e._v("where")]),e._v(" 子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如："),v("code",[e._v("select id from t where substring(name,1,3)=’abc’")]),e._v(" ，"),v("code",[e._v("name")]),e._v(" 以 "),v("code",[e._v("abc")]),e._v(" 开头的 "),v("code",[e._v("id")]),e._v(" 应改为:")]),e._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" id "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" t "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" name "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("like")]),e._v(" ‘abc"),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("%")]),e._v("’\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br")])])]),e._v(" "),v("li",[v("p",[e._v("不要在 "),v("code",[e._v("where")]),e._v(" 子句中的 "),v("code",[e._v("=")]),e._v(" 左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。")])]),e._v(" "),v("li",[v("p",[e._v("在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。")])]),e._v(" "),v("li",[v("p",[e._v("很多时候用 "),v("code",[e._v("exists")]),e._v(" 代替 "),v("code",[e._v("in")]),e._v(" 是一个好的选择："),v("code",[e._v("select num from a where num in(select num from b)")]),e._v(" 用下面的语句替换：")]),e._v(" "),v("div",{staticClass:"language-sql line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-sql"}},[v("code",[e._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" num "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" a "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("exists")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("select")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" b "),v("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("where")]),e._v(" num"),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("a"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("num"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])]),e._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[e._v("1")]),v("br")])])]),e._v(" "),v("li",[v("p",[e._v("并不是所有索引对查询都有效，SQL 是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL 查询可能不会去利用索引，如一表中有字段 "),v("code",[e._v("sex")]),e._v("、"),v("code",[e._v("male")]),e._v("、"),v("code",[e._v("female")]),e._v(" 几乎各一半，那么即使在 "),v("code",[e._v("sex")]),e._v(" 上建了索引也对查询效率起不了作用。")])]),e._v(" "),v("li",[v("p",[e._v("索引并不是越多越好，索引固然可以提高相应的 "),v("code",[e._v("select")]),e._v(" 的效率，但同时也降低了 "),v("code",[e._v("insert")]),e._v(" 及 "),v("code",[e._v("update")]),e._v(" 的效率，因为 "),v("code",[e._v("insert")]),e._v(" 或 "),v("code",[e._v("update")]),e._v(" 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过 6 个，若太多则应考虑一些不常使用到的列上建的索引是否有 必要。")])]),e._v(" "),v("li",[v("p",[e._v("尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。")])]),e._v(" "),v("li",[v("p",[e._v("尽可能的使用 "),v("code",[e._v("varchar/nvarchar")]),e._v(" 代替 "),v("code",[e._v("char/nchar")]),e._v(" ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。")])]),e._v(" "),v("li",[v("p",[e._v("任何地方都不要使用 "),v("code",[e._v("select * from table")]),e._v(" ，用具体的字段列表代替 "),v("code",[e._v("*")]),e._v(" ，不要返回用不到的任何字段。")])]),e._v(" "),v("li",[v("p",[e._v("避免频繁创建和删除临时表，以减少系统表资源的消耗。")])]),e._v(" "),v("li",[v("p",[e._v("临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。")])]),e._v(" "),v("li",[v("p",[e._v("在新建临时表时，如果一次性插入数据量很大，那么可以使用 "),v("code",[e._v("select into")]),e._v(" 代替 "),v("code",[e._v("create table")]),e._v("，避免造成大量 "),v("code",[e._v("log")]),e._v(" ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先 "),v("code",[e._v("create table")]),e._v("，然后 "),v("code",[e._v("insert")]),e._v(" 。")])]),e._v(" "),v("li",[v("p",[e._v("如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 "),v("code",[e._v("truncate table")]),e._v(" ，然后 "),v("code",[e._v("drop table")]),e._v(" ，这样可以避免系统表的较长时间锁定。")])]),e._v(" "),v("li",[v("p",[e._v("尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。")])]),e._v(" "),v("li",[v("p",[e._v("使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。")])]),e._v(" "),v("li",[v("p",[e._v("与临时表一样，游标并不是不可使 用。对小型数据集使用 "),v("code",[e._v("FAST_FORWARD")]),e._v(" 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时；在结果集中包括“合计”的例程通常要比使用游标执行的速度快；如果开发时间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。")])]),e._v(" "),v("li",[v("p",[e._v("在所有的存储过程和触发器的开始处设置 "),v("code",[e._v("SET NOCOUNT ON")]),e._v(" ，在结束时设置 "),v("code",[e._v("SET NOCOUNT OFF")]),e._v(" ，无需在执行存储过程和触发器的每个语句后向客户端发送"),v("code",[e._v("DONE_IN_PROC")]),e._v(" 消息。")])]),e._v(" "),v("li",[v("p",[e._v("尽量避免大事务操作，提高系统并发能力。")])]),e._v(" "),v("li",[v("p",[e._v("尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。")])])])])}),[],!1,null,null,null);s.default=t.exports}}]);