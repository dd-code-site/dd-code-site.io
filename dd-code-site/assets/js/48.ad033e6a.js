(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{546:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("Laravel 项目报错 "),a("code",[t._v("SQLSTATE[42000]: Syntax error or access violation: 1071 Specified key was too long")]),t._v(" 解决方法：")]),t._v(" "),a("p",[t._v("MySql支持的 "),a("code",[t._v("utf8")]),t._v(" 编码最大字符长度为 3 字节，如果遇到 4 字节的宽字符就会出现插入异常。三个字节 "),a("code",[t._v("UTF-8")]),t._v(" 最大能编码的 "),a("code",[t._v("Unicode")]),t._v(" 字符是 "),a("code",[t._v("0xffff")]),t._v("，即"),a("code",[t._v("Unicode")]),t._v(" 中的基本多文种平面（BMP）。因而包括 "),a("code",[t._v("Emoji")]),t._v(" 表情（"),a("code",[t._v("Emoji")]),t._v(" 是一种特殊的 "),a("code",[t._v("Unicode")]),t._v(" 编码）在内的非基本多文种平面的 "),a("code",[t._v("Unicode")]),t._v(" 字符都无法使用MySql的 "),a("code",[t._v("utf8")]),t._v(" 字符集存储。")]),t._v(" "),a("p",[t._v("这也应该就是 "),a("code",[t._v("Laravel 5.4")]),t._v(" 改用 4 字节长度的 "),a("code",[t._v("utf8mb4")]),t._v(" 字符编码的原因之一。不过要注意的是，只有 "),a("code",[t._v("MySql 5.5.3")]),t._v(" 版本以后才开始支持 "),a("code",[t._v("utf8mb4")]),t._v(" 字符编码（查看版本："),a("code",[t._v("selection version()")]),t._v("）。如果 MySql 版本过低，需要进行版本更新。")]),t._v(" "),a("p",[a("em",[t._v("注：如果是从Laravel 5.3 "),a("strong",[t._v("升级到 Laravel 5.4")]),t._v("，不需要对字符编码做切换。")])]),t._v(" "),a("p",[a("strong",[t._v("解决方案")])]),t._v(" "),a("ol",[a("li",[t._v("升级MySql版本到5.5.3以上。")]),t._v(" "),a("li",[t._v("手动配置迁移命令migrate生成的默认字符串长度，在app\\Providers\\AppServiceProvider中调用Schema::defaultStringLength方法来实现配置：")])]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("Illuminate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Support"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Facades"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n* Bootstrap any application services.\n*\n* @return void\n*/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("boot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Schema")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultStringLength")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("191")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[t._v("#")]),t._v(" 资料:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://ssdb.io/zh_cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("中文官网"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"http://ssdb.io/docs/zh_cn/redis-to-ssdb.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("从 Redis 迁移到 SSDB"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);